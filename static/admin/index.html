<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Decap CMS</title>
</head>
<body>
  <script>
    // Widget personalizado para videos
    if (typeof CMS !== 'undefined') {
      CMS.registerEditorComponent({
        id: "video",
        label: "Video",
        fields: [
          {
            name: "src",
            label: "Archivo de video",
            widget: "file",
            media_library: {
              allow_multiple: false,
              config: {
                max_file_size: 50000000,
                types: ["video/mp4", "video/webm", "video/ogg"]
              }
            }
          },
          {
            name: "controls",
            label: "Mostrar controles",
            widget: "boolean",
            default: true
          },
          {
            name: "width",
            label: "Ancho",
            widget: "string",
            default: "100%"
          }
        ],
        pattern: /^{{< video\s+(.*?)\s*>}}/,
        fromBlock: function(match) {
          if (!match) return {};
          const attributes = (match[1] || '').split(/\s+/);
          const attrs = {};
          attributes.forEach(attr => {
            const [key, value] = attr.split('=');
            if (key && value) {
              attrs[key] = value.replace(/["']/g, '');
            }
          });
          return {
            src: attrs.src || '',
            controls: attrs.controls !== 'false',
            width: attrs.width || '100%'
          };
        },
        toBlock: function(data) {
          const attrs = [];
          if (data.src) attrs.push(`src="${data.src}"`);
          if (data.controls === false) attrs.push('controls="false"');
          if (data.width && data.width !== '100%') attrs.push(`width="${data.width}"`);
          
          return `{{< video ${attrs.join(' ')} >}}`;
        },
        toPreview: function(data) {
          return data.src ? 
            `<div style="border: 1px dashed #ccc; padding: 10px; text-align: center; background: #f9f9f9;">
              <strong>üé• Video</strong><br/>
              <small>${data.src.split('/').pop()}</small>
            </div>` : 
            '<div>Selecciona un video</div>';
        }
      });
    }

    function initDecapCMS() {
      if (typeof CMS === 'undefined') {
        console.error("CMS no cargado");
        return;
      }

      // Configuraci√≥n EXPL√çCITA que sobrescribe el config.yml
      CMS.init();
    }

    // Inicializar con retraso
    setTimeout(initDecapCMS, 1000);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>
</html>